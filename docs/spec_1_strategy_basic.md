# 仕様書: フェーズ1 戦略パート基本

## 1. 概要

カプセル戦記の戦略シミュレーションパートの基本機能を実装する。
24x24グリッドのマップ上でユニットを移動させ、ターン制で交互にプレイする。

### 対象機能
- 1-1: マップ表示
- 1-2: ユニット配置
- 1-3: ユニット移動
- 1-4: ターン制

## 2. 関連資料

- `docs/capsule_senki_spec.md` - ゲーム全体仕様
- `docs/capsule_senki_units.md` - ユニット仕様
- `assets/gashapon/maps/map01.png` - 再現対象マップ
- `assets/gashapon/terrain/` - 地形タイル画像
- `assets/gashapon/` - ユニットスプライト画像

## 3. 機能詳細

### 3.1 画面要素

```
+------------------------------------------+
|  カプセル戦記 - 戦略パート                  |
+------------------------------------------+
|  ターン: 1  |  青軍のターン  | [ターン終了] |
+------------------------------------------+
|                                          |
|              24x24 マップ                 |
|           (地形タイル表示)                 |
|           (ユニット表示)                   |
|                                          |
+------------------------------------------+
|  選択中: ZAKU (MV:4)                      |
+------------------------------------------+
```

#### ヘッダー部
- ゲームタイトル

#### 情報バー
- 現在ターン数
- 現在プレイヤー表示（青軍/赤軍）
- ターン終了ボタン

#### マップエリア
- 24x24グリッド
- 各セル: 16x16px（全体384x384px）
- 地形タイル表示
- ユニットスプライト表示
- 選択ハイライト（黄色枠）
- 移動範囲ハイライト（青色半透明）

#### ステータスバー
- 選択中ユニット情報

### 3.2 マップデータ構造

```javascript
// 地形タイプ
const TERRAIN = {
  SPACE: 0,    // 宇宙
  PLAIN: 1,    // 平野
  FOREST: 2,   // 森林
  DESERT: 3,   // 砂漠
  CITY: 4,     // 都市
  GP: 5,       // 青軍基地
  GB: 6        // 赤軍基地
};

// 地形画像マッピング
const TERRAIN_IMAGES = {
  0: 'terrain/space.gif',
  1: 'terrain/plainicon.gif',
  2: 'terrain/foresticon.gif',
  3: 'terrain/deserticon.gif',
  4: 'terrain/cityicon.gif',
  5: 'terrain/brgpicon.gif',
  6: 'terrain/redgb.gif'
};

// 移動コスト（一般タイプ）
const MOVE_COST = {
  0: 1,   // 宇宙
  1: 1,   // 平野
  2: 2,   // 森林
  3: 3,   // 砂漠
  4: 1,   // 都市
  5: 1,   // GP
  6: 1    // GB
};

// マップデータ（24x24の2次元配列）
// map01.pngを参考に定義
```

### 3.3 ユニットデータ構造

```javascript
// ユニット定義
const unit = {
  id: 1,
  type: 'ZAKU',
  team: 'blue',      // 'blue' or 'red'
  x: 5,
  y: 10,
  mv: 4,             // 移動力
  moved: false,      // このターン移動済みか
  sprite: {
    front: 'zakubbtlf.gif',
    back: 'zakubbtlb.gif',
    side: 'zakubbtls.gif'
  }
};

// 初期配置
// 青軍: ZAKU x5（GP周辺）
// 赤軍: ZAKU x5（GB周辺）
```

### 3.4 処理ロジック

#### ゲーム初期化
1. マップデータ読み込み（map01再現）
2. 地形タイル描画
3. 初期ユニット配置
4. 青軍ターンで開始

#### ユニット選択
1. マップ上のセルをクリック
2. 自軍ユニットがいれば選択状態にする
3. 選択中ユニットをハイライト（黄色枠）
4. 移動範囲を計算してハイライト（青色半透明）

#### 移動範囲計算
```
移動可能な範囲 = 移動力(MV) - 累積移動コスト
```
- ダイクストラ法または幅優先探索で計算
- 地形の移動コストを考慮
- 他ユニットがいるマスは通過不可

#### ユニット移動
1. 移動範囲内のセルをクリック
2. ユニットを新しい位置に移動
3. `moved = true` に設定
4. 選択解除

#### ターン終了
1. 「ターン終了」ボタンクリック
2. 全ユニットの `moved = false` にリセット
3. プレイヤー切り替え（青→赤→青...）
4. ターン数インクリメント（赤→青時のみ）

## 4. 考慮事項・制限事項

### 今回実装しないもの
- WebRTC対戦機能
- 占領システム
- 生産システム
- 戦闘（遭遇しても何も起きない）
- 勝敗判定
- BGM・効果音

### 制限事項
- ブラウザ: Chrome/Firefox/Safari の最新版
- 画面サイズ: PC向け（レスポンシブ対応は後回し）
- ユニット: ZAKUのみ使用

## 5. テスト項目

### マップ表示
- [ ] 24x24グリッドが表示される
- [ ] map01の地形配置が再現されている
- [ ] 宇宙タイルが正しく表示される
- [ ] 平野タイルが正しく表示される
- [ ] 森林タイルが正しく表示される
- [ ] 砂漠タイルが正しく表示される
- [ ] 都市タイルが正しく表示される
- [ ] GP（青軍基地）タイルが正しく表示される
- [ ] GB（赤軍基地）タイルが正しく表示される

### ユニット配置
- [ ] 青軍ZAKU 5機が左側GP周辺に表示される
- [ ] 赤軍ZAKU 5機が右側GB周辺に表示される
- [ ] ユニットスプライトが正しく表示される
- [ ] ユニットが地形タイルの上に表示される

### ユニット選択
- [ ] 自軍ユニットをクリックで選択できる
- [ ] 選択中ユニットが黄色枠でハイライトされる
- [ ] 相手軍ユニットは選択できない
- [ ] 空のマスをクリックすると選択解除される
- [ ] 移動済みユニットは選択できない

### 移動範囲
- [ ] 選択時に移動範囲がハイライトされる
- [ ] 移動力4で4マス先まで移動可能
- [ ] 森林は移動コスト2で計算される
- [ ] 砂漠は移動コスト3で計算される
- [ ] 他ユニットがいるマスは移動範囲に含まれない
- [ ] 他ユニットがいるマスは通過できない

### ユニット移動
- [ ] 移動範囲内をクリックで移動できる
- [ ] 移動範囲外をクリックしても移動しない
- [ ] 移動後はユニットの位置が更新される
- [ ] 移動後は選択が解除される
- [ ] 移動後は同じユニットを再選択できない

### ターン制
- [ ] 初期状態は青軍のターン
- [ ] ターン終了ボタンで赤軍に切り替わる
- [ ] 赤軍ターン終了で青軍に切り替わる
- [ ] ターン切り替え時に全ユニットが行動可能に戻る
- [ ] 現在ターン数が表示される
- [ ] 現在プレイヤーが表示される
- [ ] 相手ターン中は自軍ユニットを操作できない
