# 仕様書: フェーズ2 戦略パート拡張

## 1. 概要

占領システムと生産システムを追加し、戦略性を向上させる。

### 対象機能
- 2-1: 占領システム
- 2-2: 生産システム

## 2. 関連資料

- `docs/capsule_senki_spec.md` - ゲーム全体仕様
- `docs/capsule_senki_units.md` - ユニット仕様
- `docs/spec_1_strategy_basic.md` - フェーズ1仕様

## 3. 機能詳細

### 3.1 占領システム

#### 占領可能施設
| 施設 | 効果 |
|------|------|
| 都市(CITY) | 占領で毎ターンCP+100、HP10%回復 |
| GP（青軍基地） | ユニット生産可能 |
| GB（赤軍基地） | 占領で生産拠点として使用可能 |

#### 占領の仕組み
1. ユニットが占領可能施設に移動
2. 「占領」コマンドを実行（移動後に選択可能）
3. 占領完了、施設の色が変わる
4. 次ターンから効果発動

#### 施設の状態
```javascript
const facility = {
    x: 9,
    y: 6,
    type: 'CITY',      // CITY, GP, GB
    owner: 'neutral',  // 'neutral', 'blue', 'red'
};
```

### 3.2 生産システム

#### CP（キャピタルポイント）
- 初期CP: 各軍1000
- 毎ターン収入: 基本100 + (占領都市数 × 100)
- 生産でCPを消費

#### 生産可能ユニット（簡易版）
| ユニット | CP | ターン | 移動力 |
|----------|-----|--------|--------|
| ZAKU | 100 | 1 | 4 |
| GOUF | 200 | 1 | 4 |
| DOM | 500 | 1 | 4 |

#### 生産の仕組み
1. 自軍の生産拠点（GP/占領GB）を選択
2. 「生産」コマンドを実行
3. 生産メニューからユニットを選択
4. CPを消費、指定ターン後にユニット出現

#### 生産キュー
```javascript
const productionQueue = {
    facilityId: 1,
    unitType: 'GOUF',
    turnsLeft: 1,
    team: 'blue'
};
```

### 3.3 画面要素の追加

```
+------------------------------------------+
|  カプセル戦記 - 戦略パート                  |
+------------------------------------------+
|  ターン: 1 | 青軍 | CP: 1000 | [ターン終了] |
+------------------------------------------+
|                                          |
|              24x24 マップ                 |
|                                          |
+------------------------------------------+
|  [情報パネル]                             |
|  選択: 都市 (青軍所有)                     |
|  [占領] [生産]  ← コマンドボタン           |
+------------------------------------------+
```

#### 情報パネル
- 選択中のユニット/施設の情報
- 実行可能なコマンドボタン

#### 生産メニュー（モーダル）
```
+---------------------------+
|  ユニット生産             |
+---------------------------+
|  ZAKU   100CP  1ターン    |
|  GOUF   200CP  1ターン    |
|  DOM    500CP  1ターン    |
+---------------------------+
|  [キャンセル]             |
+---------------------------+
```

### 3.4 施設の色表示

占領状態によって施設の色を変える:
- 中立: グレー枠
- 青軍: 青色枠/オーバーレイ
- 赤軍: 赤色枠/オーバーレイ

## 4. 処理フロー

### ターン開始時
1. CP収入計算（基本 + 都市ボーナス）
2. 生産キューのターン数を減らす
3. 完成ユニットを配置
4. 都市でのHP回復処理

### 占領コマンド
1. ユニットが施設上にいることを確認
2. 施設の所有者を変更
3. 施設の見た目を更新

### 生産コマンド
1. 生産拠点であることを確認
2. 生産メニュー表示
3. ユニット選択、CP確認
4. 生産キューに追加

## 5. 考慮事項・制限事項

### 今回実装しないもの
- 複数ターンの生産（全て1ターンで完成）
- 施設の破壊
- 詳細なユニットパラメータ（HP、攻撃力など）

### 制限事項
- 生産は1施設につき1ユニットずつ
- 施設上に他ユニットがいる場合は生産不可

## 6. テスト項目

### 占領システム
- [ ] 都市に移動後、占領コマンドが表示される
- [ ] 占領コマンド実行で施設の所有者が変わる
- [ ] 占領した施設の色が変わる
- [ ] 敵の施設も占領できる
- [ ] 中立施設を占領できる
- [ ] GPは青軍固定（占領不可）
- [ ] GBは赤軍初期所有、青軍が占領可能

### CP収入
- [ ] 初期CPが1000で表示される
- [ ] ターン開始時に基本収入100が加算される
- [ ] 占領した都市1つにつき+100される
- [ ] CP表示が更新される

### 生産システム
- [ ] 生産拠点を選択すると生産コマンドが表示される
- [ ] 生産コマンドで生産メニューが開く
- [ ] ユニットを選択するとCPが減少する
- [ ] CP不足の場合は生産できない
- [ ] 次ターン開始時にユニットが出現する
- [ ] 生産されたユニットは施設上に配置される
- [ ] 施設上に既にユニットがいる場合は生産できない

### 情報パネル
- [ ] ユニット選択時に情報が表示される
- [ ] 施設選択時に情報が表示される
- [ ] 適切なコマンドボタンが表示される
